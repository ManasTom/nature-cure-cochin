<!DOCTYPE html>
<html lang="en">

<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Admin - CPNCC</title>

    <link rel="stylesheet" href="css/style.css">

    <!-- bootstrap -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet"
        integrity="sha384-QWTKZyjpPEjISv5WaRU9OFeRpok6YctnYmDr5pNlyT2bRjXh0JMhjY6hW+ALEwIH" crossorigin="anonymous">

    <!-- Font Awesome link -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.1.1/css/all.min.css">
    <script src="https://kit.fontawesome.com/6c53136549.js" crossorigin="anonymous"></script>

    <!-- google fonts -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link
        href="https://fonts.googleapis.com/css2?family=Poppins:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap"
        rel="stylesheet">

    <link
        href="https://fonts.googleapis.com/css2?family=Courgette&family=Poppins:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&display=swap"
        rel="stylesheet">
    <link
        href="https://fonts.googleapis.com/css2?family=Courgette&family=Poppins:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&family=Sour+Gummy:ital,wght@0,100..900;1,100..900&display=swap"
        rel="stylesheet">
    <link
        href="https://fonts.googleapis.com/css2?family=Comic+Neue:ital,wght@0,300;0,400;0,700;1,300;1,400;1,700&family=Courgette&family=Poppins:ital,wght@0,100;0,200;0,300;0,400;0,500;0,600;0,700;0,800;0,900;1,100;1,200;1,300;1,400;1,500;1,600;1,700;1,800;1,900&family=Sour+Gummy:ital,wght@0,100..900;1,100..900&display=swap"
        rel="stylesheet">
</head>

<body>

    <section class="admin_header">
        <div class="row">
            <div class="col-xl-6 col-lg-6 col-md-6 col-sm-12 col-12 admin_header_col1">
                <img src="img/logo.webp" alt="">
                <p>CNPCC</p>
            </div>
            <div class="col-xl-6 col-lg-6 col-md-6 col-sm-12 col-12 admin_header_col2">
                <a href="">Logout</a>
            </div>
        </div>
    </section>

    <section class="admin_pannel">
        <div class="row">
            <div class="col-xl-2 col-lg-2 col-md-2 col-sm-12 col-12 admin_pannel_col">
                <div class="admin_pannel_toggle_switchboard">
                    <button onclick="adminPannelTreatmentsToggle()">Treatments >></button>
                    <button onclick="adminPannelReviewsToggle()">Reviews >></button>
                    <button onclick="adminPannelGalleryToggle()">Gallery >></button>
                    <button onclick="adminPannelTeamToggle()">Team >></button>
                    <button onclick="adminPannelSiteSettingsToggle()">Site Settings >></button>
                </div>
            </div>
            <div class="col-xl-10 col-lg-10 col-md-10 col-sm-12 col-12 admin_pannel_col">
                <div class="admin_pannel_treatments">
                    <div class="treatments_input_box">
                        <form action="treatments.php" method="POST" enctype="multipart/form-data">
                            <div class="row">
                                <div class="col-xl-6 col-lg-6 col-md-6 col-sm-12 col-12 treatments_input_col">
                                    <input type="text" placeholder="Treatment Title" name="treatmentTitle"
                                        id="treatmentTitle">
                                </div>
                                <div class="col-xl-6 col-lg-6 col-md-6 col-sm-12 col-12 treatments_input_col">
                                    <input type="file" placeholder="Thumbnail Image" name="treatmentImage"
                                        id="treatmentImage">
                                    <p id="currentImageName" style="font-size: 14px; color: gray;"></p>
                                    <!-- To display current image -->
                                </div>
                                <div class="col-xl-12 col-lg-12 col-md-12 col-sm-12 col-12 treatments_input_col">
                                    <textarea rows="5" placeholder="Treatment Description" name="treatmentDescription"
                                        id="treatmentDescription"></textarea>
                                </div>
                                <div class="col-xl-12 col-lg-12 col-md-12 col-sm-12 col-12 treatments_input_col">
                                    <button type="submit" class="button_2" id="saveButton">Add / Save</button>
                                </div>
                            </div>
                        </form>
                    </div>
                    <div class="treatments_table"></div>
                </div>
                <div class="admin_pannel_reviews">
                    Reviews
                </div>
                <div class="admin_pannel_gallery">
                    admin_pannel_gallery
                </div>
                <div class="admin_pannel_team">
                    <div class="team_input_box">
                        <div class="row">
                            <div class="col-xl-12 col-lg-12 col-md-12 col-sm-12 col-12 team_input_col">

                            </div>
                        </div>
                    </div>
                </div>
                <div class="admin_pannel_site_settings">
                    admin_pannel_site_settings
                </div>
            </div>
        </div>
    </section>




    <div id="footer"></div>



    <script>
        document.addEventListener("DOMContentLoaded", function () {
            const treatmentsTableDiv = document.querySelector(".treatments_table");
            const form = document.querySelector("form");
            const treatmentTitleInput = document.getElementById("treatmentTitle");
            const treatmentDescriptionInput = document.getElementById("treatmentDescription");
            const treatmentImageInput = document.getElementById("treatmentImage");
            const currentImageNameDisplay = document.getElementById("currentImageName");
            const saveButton = document.getElementById("saveButton");

            const jsonFilePath = "database/treatments/treatments.json";
            let currentEditIndex = null;
            let currentImageName = null;

            async function loadTreatments() {
                try {
                    const response = await fetch(jsonFilePath);
                    if (!response.ok) throw new Error("Failed to fetch treatments data.");

                    const treatmentsData = await response.json();
                    createTable(treatmentsData);
                } catch (error) {
                    treatmentsTableDiv.innerHTML = `<p>Error loading treatments: ${error.message}</p>`;
                }
            }

            function createTable(data) {
                const table = document.createElement("table");
                table.innerHTML = `
                    <thead>
                        <tr>
                            <th>SI No</th>
                            <th>Title</th>
                            <th>Description</th>
                            <th>Image</th>
                            <th>Actions</th>
                        </tr>
                    </thead>
                `;

                const tbody = document.createElement("tbody");

                data.forEach((item, index) => {
                    const row = document.createElement("tr");

                    // SI No
                    const siNoCell = document.createElement("td");
                    siNoCell.textContent = index + 1;
                    row.appendChild(siNoCell);

                    // Title
                    const titleCell = document.createElement("td");
                    titleCell.textContent = item.title;
                    row.appendChild(titleCell);

                    // Description with Expand/Collapse
                    const descriptionCell = document.createElement("td");
                    const shortDescription = item.description.slice(0, 50);
                    const isExpandable = item.description.length > 50;

                    const descriptionText = document.createElement("span");
                    descriptionText.textContent = shortDescription;
                    descriptionCell.appendChild(descriptionText);

                    if (isExpandable) {
                        const ellipsis = document.createElement("span");
                        ellipsis.textContent = "... ";
                        descriptionCell.appendChild(ellipsis);

                        const toggleButton = document.createElement("button");
                        toggleButton.textContent = "Expand";
                        toggleButton.style.border = "none";
                        toggleButton.style.background = "none";
                        toggleButton.style.color = "blue";
                        toggleButton.style.cursor = "pointer";
                        toggleButton.style.padding = "0";
                        toggleButton.style.margin = "0";
                        toggleButton.style.textDecoration = "underline";

                        toggleButton.addEventListener("click", () => {
                            const isExpanded = toggleButton.textContent === "Collapse";
                            descriptionText.textContent = isExpanded
                                ? shortDescription
                                : item.description;
                            ellipsis.style.display = isExpanded ? "inline" : "none";
                            toggleButton.textContent = isExpanded ? "Expand" : "Collapse";
                        });

                        descriptionCell.appendChild(toggleButton);
                    }

                    row.appendChild(descriptionCell);

                    // Image
                    const imageCell = document.createElement("td");
                    const img = document.createElement("img");
                    img.src = `database/treatments/${item.image}`;
                    img.alt = item.title;
                    img.style.width = "50px";
                    img.style.height = "50px";
                    imageCell.appendChild(img);
                    row.appendChild(imageCell);

                    // Actions
                    const actionsCell = document.createElement("td");

                    const editButton = document.createElement("button");
                    editButton.textContent = "Edit";
                    editButton.classList.add("editButton");
                    editButton.dataset.index = index;
                    actionsCell.appendChild(editButton);

                    const deleteButton = document.createElement("button");
                    deleteButton.textContent = "Delete";
                    deleteButton.classList.add("deleteButton");
                    deleteButton.dataset.index = index;
                    actionsCell.appendChild(deleteButton);

                    row.appendChild(actionsCell);
                    tbody.appendChild(row);
                });

                table.appendChild(tbody);
                treatmentsTableDiv.innerHTML = "";
                treatmentsTableDiv.appendChild(table);

                // Attach event listeners for actions
                document.querySelectorAll(".editButton").forEach(button =>
                    button.addEventListener("click", (e) => {
                        const index = e.target.dataset.index;
                        loadForEdit(data[index], index);
                    })
                );

                document.querySelectorAll(".deleteButton").forEach(button =>
                    button.addEventListener("click", (e) => {
                        const index = e.target.dataset.index;
                        deleteTreatment(index, data[index].image);
                    })
                );
            }

            function loadForEdit(item, index) {
                currentEditIndex = index;
                treatmentTitleInput.value = item.title;
                treatmentDescriptionInput.value = item.description;
                currentImageName = item.image;
                currentImageNameDisplay.textContent = `Current Image: ${item.image}`;
                form.scrollIntoView({ behavior: "smooth" });
            }

            async function deleteTreatment(index, imageName) {
                try {
                    const response = await fetch("deleteTreatment.php", {
                        method: "POST",
                        headers: { "Content-Type": "application/json" },
                        body: JSON.stringify({ index, imageName }),
                    });

                    if (!response.ok) throw new Error("Failed to delete treatment.");
                    alert("Treatment deleted successfully!");
                    loadTreatments();
                } catch (error) {
                    alert(`Error deleting treatment: ${error.message}`);
                }
            }

            form.addEventListener("submit", async function (e) {
                e.preventDefault();

                const title = treatmentTitleInput.value.trim();
                const description = treatmentDescriptionInput.value.trim();
                const image = treatmentImageInput.files[0];

                if (!title || !description || (currentEditIndex === null && !image)) {
                    alert("All fields are required.");
                    return;
                }

                const formData = new FormData();
                formData.append("title", title);
                formData.append("description", description);
                if (image) formData.append("image", image);
                if (currentEditIndex !== null) formData.append("index", currentEditIndex);
                if (currentImageName) formData.append("currentImage", currentImageName);

                try {
                    const response = await fetch("treatments.php", {
                        method: "POST",
                        body: formData,
                    });

                    if (!response.ok) throw new Error("Failed to save treatment.");
                    alert("Treatment saved successfully!");
                    currentEditIndex = null;
                    currentImageName = null;
                    currentImageNameDisplay.textContent = "";
                    form.reset();
                    loadTreatments();
                } catch (error) {
                    alert(`Error saving treatment: ${error.message}`);
                }
            });

            loadTreatments();
        });
    </script>





    <script>
        const adminPannelSiteSettings = document.querySelector('.admin_pannel_site_settings');
        const adminPannelTreatments = document.querySelector('.admin_pannel_treatments');
        const adminPannelReviews = document.querySelector('.admin_pannel_reviews');
        const adminPannelGallery = document.querySelector('.admin_pannel_gallery');
        const adminPannelTeam = document.querySelector('.admin_pannel_team');

        adminPannelReviews.style.display = "none";
        adminPannelGallery.style.display = "none";
        adminPannelTeam.style.display = "none";
        adminPannelSiteSettings.style.display = "none";

        function adminPannelTreatmentsToggle() {
            adminPannelTreatments.style.display = "block";
            adminPannelReviews.style.display = "none";
            adminPannelGallery.style.display = "none";
            adminPannelTeam.style.display = "none";
            adminPannelSiteSettings.style.display = "none";
        }
        function adminPannelReviewsToggle() {
            adminPannelTreatments.style.display = "none";
            adminPannelReviews.style.display = "block";
            adminPannelGallery.style.display = "none";
            adminPannelTeam.style.display = "none";
            adminPannelSiteSettings.style.display = "none";
        }
        function adminPannelGalleryToggle() {
            adminPannelTreatments.style.display = "none"; adminPannelReviews.style.display = "none";
            adminPannelGallery.style.display = "block";
            adminPannelTeam.style.display = "none";
            adminPannelSiteSettings.style.display = "none";
        }
        function adminPannelTeamToggle() {
            adminPannelTreatments.style.display = "none";
            adminPannelReviews.style.display = "none";
            adminPannelGallery.style.display = "none";
            adminPannelTeam.style.display = "block";
            adminPannelSiteSettings.style.display = "none";
        }
        function adminPannelSiteSettingsToggle() {
            adminPannelTreatments.style.display = "none";
            adminPannelReviews.style.display = "none";
            adminPannelGallery.style.display = "none";
            adminPannelTeam.style.display = "none";
            adminPannelSiteSettings.style.display = "block";
        }
    </script>




    <script src="js/main.js"></script>
</body>

</html>